<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Yetibot: Developer Guide</title>
    <link rel="canonical" href="https://yetibot.com/dev-guide/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/css/main.css" rel="stylesheet" type="text/css" />

    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/img/favicon/site.webmanifest">
    <link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/img/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117101667-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-117101667-1');
    </script>
  </head>
  <body class="">


    <div class="main-content">
      <nav class="navbar is-black" role="navigation" aria-label="main navigation">
        <div class="container">
          <div class="navbar-brand">
            <a class="navbar-item" href="/">
              <img class="nav-logo" src="/img/yetibot_lambda_blue_with_grey.svg"
                                    alt="Yetibot: A powerful, expressive chatops platform written in Clojure."
                                    />
            </a>

            <div class="navbar-burger" data-target="nav-menu">
              <span></span>
              <span></span>
              <span></span>
            </div>

          </div>
          <div class="navbar-menu" id="nav-menu">
            <div class="navbar-start">
              
              <a href="/user-guide/"
                class="navbar-item ">
                User Guide
              </a>
              
              <a href="/dev-guide/"
                class="navbar-item is-active">
                Developer Guide
              </a>
              
              <a href="/ops-guide/"
                class="navbar-item ">
                Operations Guide
              </a>
              
              <a href="/community/"
                class="navbar-item ">
                Community
              </a>
              
              <a href="/media/"
                class="navbar-item ">
                Media
              </a>
              
              <a class="navbar-item " href="/archives/">Blog</a>
            </div>
          </div>
        </div>
      </nav>

      

<article class="page-title hero is-light is-bold is-fullwidth">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">Developer Guide</h1>
      <p class="subtitle">Yetibot internals and dev workflows</p>
    </div>
  </div>
</article>

<section class="section content">

  <div class="container">
    <div id="page">
      <div class="main columns">
        <div class="column page-content is-two-thirds">
          <p><!&ndash; can't indent this properly because Markdown turns it into a code block &ndash;> <article class="message is-info"> <div class="message-header">   <p>Tip</p> </div> <div class="message-body">   This guide is all about developing Yetibot. It includes docs about dev   workflow and Yetibot internals.</p><ul><li>If you're more interested using Yetibot, check out the out the  <a href='/user-guide'>User Guide</a>.</li><li>If you're interested in running and operating your own instance of Yetibot,  check out the <a href='/ops-guide'>Operations Guide</a>.</div></article></li></ul><p><article class="message is-info"> <div class="message-header">   <p>Getting help</p> </div> <div class="message-body">   Although we hope the docs are useful and comprehensive,   <strong>don't hesitate to ask for help in <a href='https://slack.yetibot.com'>Slack</a>!</strong>   It could potentially save you a lot of time. </div> </article></p><p>These docs are are work in progress. If something is missing and you have questions just ask in #dev channl on <a href='https://slack.yetibot.com'>Yetibot Slack</a>. Feel free to <a href='https://github.com/yetibot/yetibot.github.io/issues'>open an issue</a> to ask questions or suggest changes.</p><p><strong>Don't hesitate to ask for help in Slack!</strong> It could potentially save you a lot of time.</p><h2 id="building&#95;your&#95;first&#95;command">Building your first command</h2><h2 id="command&#95;pipeline">Command pipeline</h2><h3 id="command&#95;arguments">Command arguments</h3><p>Use <code>raw all</code> to view arguments.</p><h4 id="data">Data</h4><h3 id="push&#95;down&#95;operations">Push down operations</h3><p>Yetibot has the ability to look ahead into the command pipeline and optionally consume subsequent commands from a command handler function. In relational algebra this is often referred to as pushing down an operation.</p><p>Consider <code>history | random</code> as an example. The <code>history</code> command looks ahead at the next commands in the pipeline, sees that it's a command it knows how to consume (<code>random</code>), and tells the command execution pipeline to skip it for efficiency and instead handle itself.</p><p>Imagine the default naive method Yetibot would execute if this were not the case:</p><ol><li>Load all history into a data structure</li><li>Pass the data structure to <code>random</code> which calls <code>rand-nth</code> on the collection.   According to the <a href='https://public.yetibot.com/'>public Yetibot dashboard</a> at   the time of writing we have 12,723 entries in the history table. This isn't   that much but you can imagine how slow it'd be as the table continues to   grow.</li></ol><p>The full set of commands that <code>history</code> consumes are defined in <a href='https://github.com/yetibot/yetibot.core/blob/f2e045002e20adccb79adbb84eb12566fc99c51e/src/yetibot/core/commands/history.clj#L8'><code>yetibot.core.commands.history/consumeables</code></a>:</p><pre><code class="clojure">&#40;def consumables #{&quot;head&quot; &quot;tail&quot; &quot;count&quot; &quot;grep&quot; &quot;random&quot;}&#41;
</code></pre><p>See <a href='https://github.com/yetibot/yetibot.core/blob/master/src/yetibot/core/commands/history.clj#L46-L61'>the history command</a> for a full example.</p><h3 id="timeouts">Timeouts</h3><h3 id="testing&#95;commands">Testing commands</h3><ol><li>Using <code>command-execution-info</code></li><li>Mocking with Midje</li></ol><h2 id="working&#95;with&#95;the&#95;database">Working with the database</h2><h2 id="parser">Parser</h2><h2 id="graphql&#95;api">GraphQL API</h2><p>Yetibot hosts a GraphQL powered API. The public instance is available at <a href='https://public.yetibot.com/graphql'>https://public.yetibot.com/graphql</a>. Try hitting it with <code>curl</code>:</p><pre><code class="bash">curl 'https://public.yetibot.com/graphql' \
  -H 'Accept: application/json' \
  --data 'query=%7Beval&#40;expr%3A%20%22uptime%22&#41;%7D' \
  --compressed
</code></pre><h2 id="web&#95;dashboard">Web dashboard</h2><p>Yetibot hosts a web-based frontend powered by the GraphQL API. See the public instance at <a href='https://public.yetibot.com'>public.yetibot.com</a>.</p><h2 id="ðŸ¤”">ðŸ¤”</h2><p><article class="message is-info"> <div class="message-header">   <p>Docs didn't answer your question?</p> </div> <div class="message-body">   Ask us in <a href='https://slack.yetibot.com'>Slack</a> or   <a href='https://github.com/yetibot/community/issues/new'>open a new issue</a>   on the <code>community</code> repo. </div> </article></p>
        </div>

        <div class="column toc">
          <ol class="content"><li><a href="#building_your_first_command">Building your first command</a></li><li><a href="#command_pipeline">Command pipeline</a></li><ol><li><a href="#command_arguments">Command arguments</a></li><ol><li><a href="#data">Data</a></li></ol><li><a href="#push_down_operations">Push down operations</a></li><li><a href="#timeouts">Timeouts</a></li><li><a href="#testing_commands">Testing commands</a></li></ol><li><a href="#working_with_the_database">Working with the database</a></li><li><a href="#parser">Parser</a></li><li><a href="#graphql_api">GraphQL API</a></li><li><a href="#web_dashboard">Web dashboard</a></li><li><a href="#ðŸ¤”">ðŸ¤”</a></li></ol>
        </div>
      </div>

      <div id="prev-next">
        
        <a class="button is-warning" href="/user-guide/">&laquo; User Guide</a>
        
        

        
        
        <a class="button is-warning" href="/ops-guide/">Operations Guide &raquo;</a>
        
      </div>
    </div>
  </div>

</section>



    </div>

    <footer class="footer">
      <div class="content has-text-centered">
        <p>
          <strong>Yetibot</strong> by <a href="https://devth.com">Trevor
            Hartman</a> & contributors.
          <br />
          Distributed under the
          <a href="https://opensource.org/licenses/eclipse-1.0.php">
            Eclipse Public License 1.0</a>.
          <br />
          Artwork by
          <a href="http://www.freeformdesign.co/">Freeform Design Co.</a>
          in <strong>Montana</strong>.
          <br />

          This site is continously delivered from
          <a href="https://github.com/yetibot/yetibot.github.io">
             source</a>.
        </p>
      </div>
    </footer>

    <script src="https://cdn.rawgit.com/f/graphql.js/master/graphql.min.js"
            type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <script src="/js/yetibot.js" type="text/javascript" charset="utf-8"></script>
    <script src="/js/highlight.pack.js" type="text/javascript"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

